
# User Manual

## Overview

ESYNet is a cycle-accuracy network-on-chip simulator, which is the 
interconnection architecture of ESYSim. Branch `esynet` provides the basic 
version of ESYNet. 

ESYNet provides many options so that ESYNet can be used to simulate a wide of 
situations. Moreover, ESYNet delivers the flexibility to adapt to irregular or 
custom situations.

- **Topology**. ESYNet supports regular topologies, including switch, ring, 
2D-mesh/torus, and dimension mesh/torus. The network can be defined by options. 
ESYNet can also accept irregular topologies defined by a network configuration 
file. The irregular topology can be defined in VisualNoC.

- **Routing algorithm**. ESYNet provides built-in routing algorithms for 
different topologies. Moreover, ESYNet provides a table-based routing algorithm 
so that users can implement custom deterministic routing algorithm without 
modifying the simulator. At last, ESYNet provides the ability to add new 
routing algorithms within the simulator, which is useful for dynamic routing 
algorithm, e.g., fault-tolerant routing algorithms.

- **Switch Methods**. ESYNet provides wormhole switch for all topologies. Flits 
deliver if there is any free slot in the neighbor. To avoid deadlock, ESYNet 
also provides specific switch method for ring topology (includes torus and 
dimension torus as well which are formed by rings). Packets cannot be injected 
into the ring unless there are enough continuous free slots.

- **Flow control**. ESYNet support credit-based flow control methods. A router 
knows the number of free slots in the input buffers of its neighbors.

- **Arbiter**. ESYNet implements three different arbiters, which are random 
arbiter, round-robin arbiter, and matrix arbiter. The priority of one request 
can be adjusted explicitly.

- **Traffic generator**. ESYNet can inject packets following traffic profiles 
and injection rate specified options. Also, ESYNet can receive benchmark trace 
file to inject packets. At last, ESYNet provides APIs to receive packets 
generated by full-system simulators.

- **Event trace**. ESYNet can record the simulation procedure into an event 
trace file, which can be used by VisualNoC to replay the simulation. Also, 
ESYNet support on-line simulation replay.

### Install and Compile

Download the code from GitHub. One way is to download the full package of 
ESYSim project and check out to `esynet` branch.

```shell
git clone https://github.com/wangeddie67/ESYSim.git
cd ESYSim
git checkout esynet
```

The other way is to download the `esynet` branch only.

```shell
git clone -b esynet https://github.com/wangeddie67/ESYSim.git
```

After downloading, enter `esynet` folder and run Makefile.

```shell
cd ESYSim/esynet
make
```

After compiling, the executable file `esynet` can be found in the folder 
`esynet/bin`. Run `esynet` directly to verify the installation.

```shell
cd ESYSim/esynet/bin
./esynet
```

Doxygen is necessary to generate the implementing document. Run following 
command in the direction of `ESYSim`.

```shell
mkdir -p docs
doxygen doxygencfg_esynet
```

The generated document can be found in `docs/esynet`. Open 
`docs/esynet/html/index.html` to in web viewer view the document.

## Command Line

ESYNet defines the options list based on `EsyArgumentList`. The default options 
are as follow:

- Option `-h` or `-help` prints optional list.

- Option `-xml` prints argument XML file used by VisualNoC. 
```sh
-xml <file_path> -xmlexec <executing_command> -xmlcomp <compiling_command> -xmlname <tool_name>
```

The options of ESYNet can be categorized into several groups as follow.

### Network Configuration Options

These options are used to specify the topology, routing algorithm, and switch 
method of the network as well as the architecture of the router and the network 
interface.

```sh
-topology [Switch|Ring|2DMesh|2DTorus|DiaMesh|DiaTorus] 
-network_size <integar_list>
-phy_number <integar>
-vc_number <integar>
-in_buffer_size <integar>
-out_buffer_size <integar>
-data_path_width <integar>
-link_length <double>
-routing_alg [SingleRing|DoubleRing|XY|TXY|DyXY|Table|DiaMesh|DiaTorus]
-routing_table <file_path_with_extension>
-arbiter [Random|RR|Matrix]
-switch [Wormhole|Ring]
-ni_buffer_size <integar>
-ni_read_ready <integar>
-network_cfg_file_enable
-network_cfg_out_file_enable
-network_cfg_file_name <file_path_without_extension>
```

- Option `-topology` specifies network topology. `DiaMesh` and `DiaTorus` mean 
cube topology with multiple dimensions.

- Option `-network_size` specifies network size. This option accepts a list of 
integers. Each number specifies the number of routers in one dimension. For 
switch topology, it must be 1; for ring topology, it only accepts one number; 
for mesh topology, it must accept two numbers. 

- Option `-phy_number` specifies the number of physical channels in one router.

- Option `-vc_number` specifies the number of virtual channels in each physical 
channel.

- Option `-in_buffer_size` specifies the number of slots of the input buffer 
for one virtual channel of one physical channel.

- Option `-out_buffer_size` specifies the number of slots of the output buffer 
for one virtual channel of one physical channel.

- Option `-data_path_width` specifies the width of the data path, in bits.

- Option `-link_length` specifies the physical length of the link between 
routers, in um.

- Option `-routing_alg` specifies the routing algorithm. `SingleRing` and 
`DoubleRing` are valid for Ring topology only. `XY` and `DyXY` are valid for 2D 
Mesh topology only. `TXY` are valid for 2D Torus topology only. `DiaMesh` and 
`DiaTorus` are valid for dimension cube topology only. `Table` enables the 
table-based routing algorithm.

- Option `-routing_table` specifies the routing table file used for table-based 
routing algorithm.

- Option `-arbiter` specifies the type of arbiter.

- Option `-switch` specifies the switch method. `Ring` is only valid for the 
ring topology.

- Option `-ni_buffer_size` specifies the number of slots of the NI.

- Option `-ni_read_ready` specifies the time before the received packet is 
removed from NI.

- Option `-network_cfg_file_enable` means the network is configured by network 
configuration file. If this option appears, other options are disabled.

- Option `-network_cfg_out_file_enable` means the network topology is stored in 
network configuration file. This option is valid only when 
`-network_cfg_file_enable` does not appear.

- Option `-network_cfg_file_name` specifies the input or output network 
configuration file.

See [Network Generator](https://github.com/wangeddie67/ESYSim/wiki/ESYNet-User-Manual-:-Network-Generator) for details.

### Simulation Control Options

These options are used to control the simulation procedure. 

```sh
-random_seed <integar>
-simulation_period <double>
-injected_packet <integar>
-warmup_packet <integar>
-latency_measure_packet <integar>
-throughput_measure_packet <integar>
-sim_length <double>
```

- Option `-random_seed` specifies the seed for the random generator. 

- Option `-simulation period` specifies the period of simulation, in cycle. 
Default is 1.0.

- Option `-injected_packet` specifies the total number of injected packets. 
Packet generator stops injecting new packets after the number of injected 
packets reach specified value, and the simulation stops after all injected 
packets are accepted.

- Option `-warmup_packet` specifies the number of ignored packets before 
measuring latency and throughput.

- Option `-latency_measure_packet` specifies the number of packets to 
measure latency. A simulation stops if latency and throughput measurement 
finishes.

- Option `-throughput_measure_packet` specifies the number of packets to 
measure throughput. A simulation stops if latency and throughput measurement 
finishes.

- Option `-sim_length` specifies the simulation length, in cycle.

See [Simulation Control](https://github.com/wangeddie67/ESYSim/wiki/ESYNet-User-Manual-:-Simulation-Control) for details.

### Traffic Injection Options

These options are used to specify the injected traffic during the simulation. 
The necessary options include the traffic pattern and the packet injection rate.

```sh
-traffic_injection_disable
-input_trace_enable
-input_trace_file_text_enable
-input_trace_buffer_size <integar>
-input_trace_file_name <file_path_without_extension>
-traffic_rule [TP_UNIFORM|TP_TRANSPOSE1|TP_TRANSPOSE2|TP_BITREVERSAL|TP_BUTTERFLY|TP_SHUFFLE]
-traffic_pir <double_range_(0,1)>
-packet_size <integar>
-output_trace_enable
-output_trace_file_text_enable
-output_trace_buffer_size <integar>
-output_trace_file_name <file_path_without_extension>
```

- Option `-traffic_injection_disable` means traffic generator is disabled. No 
packet is injected into the network by traffic generator. If 
`-traffic_injection_disable` appears, other options does not work except the 
options to generate benchmark trace file (`-output_trace_enable`, 
`-output_trace_file_text_enable`, `-output_trace_buffer_size`, and 
`-output_trace_file_name`).

- Option `-input_trace_enable` means traffic generator injects packets 
according to a benchmark trace file, which records the time, source and 
destination of each packets. If `-input_trace_enable` appears, option 
`-traffic_rule`, `-traffic_pir`, and `-packet_size` do not work. Otherwise, 
Option `-input_trace_file_text_enable`, `-input_trace_buffer_size`, and 
`-input_trace_file_name` do not work.

- Option `-input_trace_file_text_enable` means the input benchmark trace file 
is text format.

- Option `-input_trace_buffer_size` specifies the size of input stream buffer 
to input benchmark trace file.

- Option `-input_trace_file_name` specifies the path of input benchmark trace 
file. File extension should not appear.

- Option `-traffic_rule` specifies the traffic profiles to generate packets. 
Traffic profiles specify the relationship between destination and source 
address.

- Option `-traffic_pir` specifies the packet injection rate (PIR) to generate 
packets. The unit of PIR is packet/cycle/NI. The valid value ranges from 0.0 to 
1.0, which means one NI can inject at most 1 packets at one cycle.

- Option `-packet_size` specifies the size of flit in packet injection rate. 

- Option `-output_trace_enable` means the simulator records all packets into a 
benchmark trace file. It is only possible if the traffic generator injects 
according to the traffic profile and packet injection rate.

- Option `-output_trace_file_text_enable` means the output stream prints the 
benchmark trace into a text-format file as well a binary-format file.

- Option `-output_trace_buffer_size` specifies the size of the output stream 
buffer to output benchmark trace file.

- Option `-output_trace_file_name` specifies the path of output benchmark trace 
file. The file extension should not appear.

See [Traffic Generator](https://github.com/wangeddie67/ESYSim/wiki/ESYNet-User-Manual-:-Traffic-Generator) for details.

### Event Trace Options

These options are used to specify the event trace file and the output stream to 
the event trace file.

```sh
-event_trace_enable
-event_trace_file_text_enable
-event_trace_buffer_size <integar>
-event_trace_file_name <file_path_without_extension>
-event_trace_cout_enable
```

- Option `-event_trace_enable` means the simulator records the simulation into 
an event trace file. 

- Option `-output_trace_file_text_enable` means the output stream prints the 
event trace into a text-format file as well a binary-format file.

- Option `-output_trace_buffer_size` specifies the size of the output stream 
buffer to output event trace file.

- Option `-output_trace_file_name` specifies the path of output event trace 
file. The file extension should not appear.

See [Event Trace](https://github.com/wangeddie67/ESYSim/wiki/ESYNet-User-Manual-:-Event-Trace) for details.

## Examples
